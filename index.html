<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google Dino Game with Real-Time Leaderboard</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f7f7f7;
            font-family: Arial, sans-serif;
        }
        #canvas {
            border: 1px solid #ccc;
            background-color: white;
        }
        #leaderboard {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border: 1px solid #ccc;
            max-width: 200px;
        }
        #leaderboard h3 {
            margin: 0 0 10px;
        }
        #leaderboard ol {
            margin: 0;
            padding-left: 20px;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js"></script>
</head>
<body>
    <canvas id="canvas" width="600" height="200"></canvas>
    <div id="leaderboard">
        <h3>Top Scores</h3>
        <ol id="leaderboard-list"></ol>
    </div>

    <script>
        // Replace with your own Firebase config
        // Go to console.firebase.google.com, create a project, enable Firestore, and get the config
        const firebaseConfig = {
            apiKey: "AIzaSyB6ADugySKGAhxK0yrLWVrPZrqhYeKRnG4",
            authDomain: "std114514.firebaseapp.com",
            projectId: "std114514",
            storageBucket: "std114514.firebasestorage.app",
            messagingSenderId: "833464029809",
            appId: "1:833464029809:web:eb51e6547776db8b5e41d0"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // Function to submit score
        async function submitScore(username, score) {
            try {
                const docRef = await db.collection("scores").add({
                    username: username,
                    score: score,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log("Score submitted!");
            } catch (error) {
                console.error("Error submitting score: ", error);
            }
        }

        // Function to update leaderboard in real-time
        function updateLeaderboard() {
            const list = document.getElementById("leaderboard-list");
            list.innerHTML = "";
            db.collection("scores")
                .orderBy("score", "desc")
                .limit(10)
                .onSnapshot(snapshot => {
                    list.innerHTML = "";
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const li = document.createElement("li");
                        li.textContent = `${data.username}: ${data.score}`;
                        list.appendChild(li);
                    });
                });
        }

        // Call to update leaderboard on load
        updateLeaderboard();

        // Game Logic Below
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        // Game variables
        let dino = { x: 50, y: 150, width: 20, height: 40, dy: 0, gravity: 0.5, jump: -10, isJumping: false };
        let obstacles = [];
        let score = 0;
        let gameOver = false;
        let gameSpeed = 5;

        // Draw dino
        function drawDino() {
            ctx.fillStyle = "green";
            ctx.fillRect(dino.x, dino.y, dino.width, dino.height);
        }

        // Draw obstacle
        function drawObstacle(obstacle) {
            ctx.fillStyle = "red";
            ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
        }

        // Update game
        function update() {
            if (gameOver) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dino physics
            dino.dy += dino.gravity;
            dino.y += dino.dy;
            if (dino.y > 150) {
                dino.y = 150;
                dino.isJumping = false;
            }

            drawDino();

            // Generate obstacles
            if (Math.random() < 0.02) {
                obstacles.push({ x: canvas.width, y: 150, width: 20, height: 40 });
            }

            // Move and draw obstacles
            obstacles.forEach((obs, index) => {
                obs.x -= gameSpeed;
                drawObstacle(obs);
                if (obs.x + obs.width < 0) {
                    obstacles.splice(index, 1);
                    score++;
                }

                // Collision detection
                if (
                    dino.x < obs.x + obs.width &&
                    dino.x + dino.width > obs.x &&
                    dino.y < obs.y + obs.height &&
                    dino.y + dino.height > obs.y
                ) {
                    gameOver = true;
                    alert(`Game Over! Score: ${score}`);
                    const username = prompt("Enter your username to submit score:");
                    if (username) {
                        submitScore(username, score);
                    }
                }
            });

            // Draw score
            ctx.fillStyle = "black";
            ctx.font = "20px Arial";
            ctx.fillText(`Score: ${score}`, 10, 30);

            requestAnimationFrame(update);
        }

        // Jump on space or click
        document.addEventListener("keydown", (e) => {
            if (e.code === "Space" && !dino.isJumping) {
                dino.dy = dino.jump;
                dino.isJumping = true;
            }
        });
        canvas.addEventListener("click", () => {
            if (!dino.isJumping) {
                dino.dy = dino.jump;
                dino.isJumping = true;
            }
        });

        // Start game
        update();
    </script>

    <p style="position: absolute; bottom: 10px; text-align: center; width: 100%;">Note: Set up Firebase project and replace config. In Firestore, allow read/write in rules for testing (allow read, write: if true;). Press Space to jump.</p>
</body>
</html>
