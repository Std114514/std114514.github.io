<!DOCTYPE html>
<html lang="en">
<title>ranking</title>
<h1>欢迎来到 std114514 的小站！</h1>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Dinosaur Game with Leaderboard</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
        .game {
            width: 600px;
            height: 200px;
            border: 1px solid #000000;
            margin: auto;
        }
        #dino {
            width: 70px;
            height: 70px;
            background-image: url(t-rex.png); /* Replace with your image URL or path */
            background-size: auto 70px;
            position: relative;
            top: 143px;
        }
        .jump {
            animation: jump 0.3s linear;
        }
        @keyframes jump {
            0% {
                top: 143px;
            }
            30% {
                top: 115px;
            }
            50% {
                top: 70px;
            }
            80% {
                top: 115px;
            }
            100% {
                top: 143px;
            }
        }
        #cactus {
            width: 20px;
            height: 40px;
            position: relative;
            top: 91px;
            left: 580px;
            background-image: url(cactus.png); /* Replace with your image URL or path */
            background-size: 20px 40px;
            animation: cactus-block 1.2s infinite linear;
        }
        @keyframes cactus-block {
            0% {
                left: 600px;
            }
            100% {
                left: -20px;
            }
        }
        #score {
            text-align: center;
            font-size: 20px;
            margin: 10px auto;
        }
        #leaderboard {
            width: 600px;
            margin: auto;
            border: 1px solid #000;
            padding: 10px;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
</head>
<body>
    <div class="game">
        <div id="dino"></div>
        <div id="cactus"></div>
    </div>
    <div id="score">Score: 0</div>
    <div id="leaderboard">
        <h3>Realtime Leaderboard (Top 10)</h3>
        <ul id="leaderboard-list"></ul>
    </div>
    <script>
        // Replace with your own Firebase config
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Get visitor IP
        let visitorIP = 'unknown';
        fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                visitorIP = data.ip;
            })
            .catch(error => console.error('Error fetching IP:', error));

        // Game logic
        const dino = document.getElementById("dino");
        const cactus = document.getElementById("cactus");
        let score = 0;
        let isAlive = true;
        let scoreInterval;

        function startGame() {
            isAlive = true;
            score = 0;
            document.getElementById('score').textContent = 'Score: 0';
            cactus.style.animation = 'cactus-block 1.2s infinite linear';
            scoreInterval = setInterval(() => {
                if (isAlive) {
                    score++;
                    document.getElementById('score').textContent = 'Score: ' + score;
                }
            }, 100);
        }

        function jump() {
            if (!dino.classList.contains("jump")) {
                dino.classList.add("jump");
                setTimeout(function () {
                    dino.classList.remove("jump");
                }, 300);
            }
        }

        let checkAlive = setInterval(function () {
            if (!isAlive) return;
            let dinoTop = parseInt(window.getComputedStyle(dino).getPropertyValue("top"));
            let cactusLeft = parseInt(window.getComputedStyle(cactus).getPropertyValue("left"));
            if (cactusLeft > 0 && cactusLeft < 70 && dinoTop >= 143) {
                isAlive = false;
                cactus.style.animationPlayState = "paused";
                clearInterval(scoreInterval);
                alert("Whoops! Game Over :( Your score: " + score);
                // Upload score to Firebase
                if (visitorIP !== 'unknown') {
                    db.ref('scores').push({
                        ip: visitorIP,
                        score: score,
                        timestamp: Date.now()
                    });
                }
                // Restart option
                if (confirm("Play again?")) {
                    startGame();
                }
            }
        }, 10);

        document.addEventListener("keydown", function (event) {
            if (isAlive) jump();
        });

        // Load and display leaderboard in real-time
        db.ref('scores').orderByChild('score').limitToLast(10).on('value', function(snapshot) {
            let scores = [];
            snapshot.forEach(function(childSnapshot) {
                scores.push(childSnapshot.val());
            });
            scores.sort((a, b) => b.score - a.score);
            let list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            scores.forEach(s => {
                let li = document.createElement('li');
                li.textContent = `${s.ip}: ${s.score}`;
                list.appendChild(li);
            });
        });

        // Start the game initially
        startGame();
    </script>
    <p style="text-align: center;">Note: You need to create a Firebase project at https://console.firebase.google.com/ and replace the firebaseConfig with your own details. Also, download t-rex.png and cactus.png images and place them in the same directory, or use online URLs. Set Firebase Realtime Database rules to allow read/write for demo purposes (e.g., {"rules": {".read": true, ".write": true}}).</p>
</body>
</html>
